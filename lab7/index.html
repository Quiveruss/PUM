<!DOCTYPE html>
<html>
  <head>
    <title>Lab6_1</title>
  </head>
  <body>
    <h1>Lab 6_1</h1>

    <canvas
      id="myCanvas"
      width="800"
      height="600"
      style="border: 3px solid black"
    >
      Your browser does not support the HTML canvas tag.
    </canvas>

    <script>
      var c = document.getElementById("myCanvas");
      var ctx = c.getContext("2d");

      const player = {
        x: 400,
        y: 510,
        w: 50,
        h: 80,
        dx: 0,
        dy: 0,
        speed: 5,
        alive: true,
        bonuses: 0,
      };

      const map = {
        grass: {
          x: -200,
          y: -200,
          w: c.width + 400,
          h: c.height + 400,
        },

        road: {
          x: 150,
          y: -200,
          w: 500,
          h: c.height + 400,
        },
      };

      function clear() {
        ctx.clearRect(0, 0, c.width, c.height);
      }

      function drawScenery() {
        ctx.beginPath();

        // Grass
        ctx.fillStyle = "green";
        ctx.fillRect(map.grass.x, map.grass.y, map.grass.w, map.grass.h);

        // Main road
        ctx.fillStyle = "gray";
        ctx.fillRect(map.road.x, map.road.y, map.road.w, map.road.h);

        // Left road border
        const edgesWhiteAmount = map.edgesWhite.amount;

        for (var i = 0; i < edgesWhiteAmount; ++i) {
          ctx.fillStyle = "white";
          ctx.fillRect(
            map.edgesWhite.leftX,
            map.edgesWhite.y + i * 60 + map.edgesWhite.dy,
            map.edgesWhite.w,
            map.edgesWhite.h
          );
        }
      }

      function drawPlayer() {
        ctx.beginPath();
        ctx.fillStyle = "black";
        ctx.fillRect(player.x, player.y, player.w, player.h);
      }

      function playerNewPos() {
        player.x += player.dx;

        if (player.x < 150) {
          player.x = 150;
        }
        if (player.x + player.w > 650) {
          player.x = 650 - player.w;
        }

        player.y += player.dy;

        if (player.y < 0) {
          player.y = 0;
        }
        if (player.y + player.h > c.height) {
          player.y = c.height - player.h;
        }
      }

      function displayDeath() {
        ctx.font = "70px arial";
        ctx.fillStyle = "red";
        ctx.textAlign = "center";
        ctx.fillText("Game over", c.width / 2, c.height / 2);
      }

      function update() {
        clear();

        drawScenery();

        drawPlayer();
        playerNewPos();

        if (player.alive) {
          requestAnimationFrame(update);
        } else {
          displayDeath();
        }
      }

      function moveRight() {
        player.dx = player.speed;
      }

      function keyDown(e) {
        console.log(e.key);
        if (e.key === " ") {
          jump();
        }
      }

      function keyUp(e) {
        if (
          e.key === "ArrowRight" ||
          e.key === "Right" ||
          e.key === "ArrowLeft" ||
          e.key === "Left"
        ) {
          player.dx = 0;
        }
      }

      update();
      document.addEventListener("keydown", keyDown);
      document.addEventListener("keyup", keyUp);
    </script>
  </body>
</html>
